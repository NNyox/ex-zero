<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap" rel="stylesheet">
  <title>Equis-Cero</title>
  <style>
    :root {
      --border: solid black 2px;
      --color: red;
    }
    body {
      padding: 0;
      margin: 0;
      transition: all 500ms;
      background-color: color-mix(in srgb, var(--color), white 75%);
    }
    *{
      user-select: none;
      font-family: 'Franklin Gothic';
      /* transition: all ease-out 0.5s; */
    }
    #particles-js {
      position: absolute;
      height: 99vh;
      width: 99vw;
    }
      .particles-animation {
        animation: particles 0.7s linear forwards;
      }
      @keyframes particles {
        from{height: 0; opacity: 0;}
        to{height: 99vh; opacity: 1;}
      }
    .center {
      position: absolute;
      transform: translate(-50%, -50%);
      left: 50%;
      top: 50%;
    }
    #table {
      width: 75vw; max-width: 350px;
      aspect-ratio: 1 / 1;
      display: grid; grid-template-rows: repeat(3, 1fr);grid-template-columns: repeat(3, 1fr);
      place-items: center;
    }
    .tableAnimation {
      pointer-events: none;
      animation: getBigger 0.7s linear forwards;
    }
    .barZone {
      z-index: -1;
      width: 75vw; max-width: 350px;
      aspect-ratio: 1 / 1;
    }
    .barZoneAnimation {
      animation: getBigger 0.7s linear forwards;
    }
    @keyframes getBigger {
      from {}
      to {
        opacity: 0.3;
        transform: translate(-50%, -50%) scale(1.1);
      }
    }
    .bar {
      position: absolute;
      transform: translate(-50%, -50%);
      left: 50%;
      top: 50%;
      background-color: var(--color);
      border-radius: 5px;
      height: 5px;
      transform-origin: center;
    }
    .barAnimation {
      animation: extend 1s forwards;
    }
    @keyframes extend {
      from {width: 0;}
      to {width: 100%;}
    }
    .face {
      height: 100%;
      width: 100%;
    }
      #face4, #face6 {
        border-bottom: var(--border);
        border-top: var(--border);
      }
      #face2, #face8 {
        border-left: var(--border);
        border-right: var(--border);
      }
      #face5 {
        border-left: var(--border);
        border-bottom: var(--border);
        border-right: var(--border);
        border-top: var(--border);
      }
      .figure {
        position: absolute;
        width: calc(100% / 3); height: calc(100% / 3);
        opacity: 0;
      }
        .part {
          position: absolute;
          width: calc(100% / 3);
          --lr: translate(-50%, -50%);
          top: 50%;
          left: 50%;
        }
        #equis > .lat {
          border: solid red 2px;
          border-radius: 2px;
        }
          #equis > .li {
            transform: var(--lr) rotate(-45deg);
          }
          #equis > .ld {
            transform: var(--lr) rotate(45deg);
          }
        #cero > .ci {
          width: 25%;
          border: solid blue 3px;
          border-radius: 100%;
          aspect-ratio: 1 / 1;
          transform: var(--lr);
        }
    #button {
      font-size: clamp(10px, 30px, 10vw);
      position: absolute;
      transform: translate(-50%, -50%);
      left: 50%;
      bottom: 1%;
      border: none;
      background: none;
    }
    #text {
      /* transition: all ease-in-out 0.5s; */
      font-size: clamp(10px, 40px, 10vw);
      position: absolute;
      transform: translate(-50%, -50%);
      left: 50%;
      top: 10%;
    }
    .textAnimation {
      animation: 0.7s winMove;
      animation-fill-mode: forwards;
    }
    @keyframes winMove {
      from {}
      to {
        font-size: clamp(10px, 60px, 12vw);
      }
    }
  </style>
</head>

<body>
  <div id="particles-js"></div>
  <div id="table" class="center">
    <div class="face" id="face1">
      <div class="figure" id="equis">
        <div class="part lat li"></div>
        <div class="part lat ld"></div>
      </div>
      <div class="figure" id="cero">
        <div class="part ci"></div>
      </div>
    </div>
    <div class="face" id="face2">
      <div class="figure" id="equis">
        <div class="part lat li"></div>
        <div class="part lat ld"></div>
      </div>
      <div class="figure" id="cero">
        <div class="part ci"></div>
      </div>
    </div>
    <div class="face" id="face3">
      <div class="figure" id="equis">
        <div class="part lat li"></div>
        <div class="part lat ld"></div>
      </div>
      <div class="figure" id="cero">
        <div class="part ci"></div>
      </div>
    </div>
    <div class="face" id="face4">
      <div class="figure" id="equis">
        <div class="part lat li"></div>
        <div class="part lat ld"></div>
      </div>
      <div class="figure" id="cero">
        <div class="part ci"></div>
      </div>
    </div>
    <div class="face" id="face5">
      <div class="figure" id="equis">
        <div class="part lat li"></div>
        <div class="part lat ld"></div>
      </div>
      <div class="figure" id="cero">
        <div class="part ci"></div>
      </div>
    </div>
    <div class="face" id="face6">
      <div class="figure" id="equis">
        <div class="part lat li"></div>
        <div class="part lat ld"></div>
      </div>
      <div class="figure" id="cero">
        <div class="part ci"></div>
      </div>
    </div>
    <div class="face" id="face7">
      <div class="figure" id="equis">
        <div class="part lat li"></div>
        <div class="part lat ld"></div>
      </div>
      <div class="figure" id="cero">
        <div class="part ci"></div>
      </div>
    </div>
    <div class="face" id="face8">
      <div class="figure" id="equis">
        <div class="part lat li"></div>
        <div class="part lat ld"></div>
      </div>
      <div class="figure" id="cero">
        <div class="part ci"></div>
      </div>
    </div>
    <div class="face" id="face9">
      <div class="figure" id="equis">
        <div class="part lat li"></div>
        <div class="part lat ld"></div>
      </div>
      <div class="figure" id="cero">
        <div class="part ci"></div>
      </div>
    </div>
  </div>
  <div class="barZone center">
    <div class="bar"></div>
  </div>
  <a href="">
    <button id="button">reiniciar</button>
  </a>
  <span id="text" style="color: var(--color);">turno de X</span>

  <script src="particles.min.js"></script>
  <script>
    let particles = {
      "particles": {
        "number": {
          "value": 160,
          "density": {
            "enable": true,
            "value_area": 800
          }
        },
        "color": {
          "value": "#ff0000"
        },
        "shape": {
          "type": "star",
          "stroke": {
            "width": 0,
            "color": "#000000"
          },
          "polygon": {
            "nb_sides": 5
          },
          "image": {
            "src": "img/github.svg",
            "width": 100,
            "height": 100
          }
        },
        "opacity": {
          "value": 1,
          "random": true,
          "anim": {
            "enable": true,
            "speed": 1,
            "opacity_min": 0,
            "sync": false
          }
        },
        "size": {
          "value": 5,
          "random": true,
          "anim": {
            "enable": false,
            "speed": 4,
            "size_min": 0.3,
            "sync": false
          }
        },
        "line_linked": {
          "enable": false,
          "distance": 150,
          "color": "#ffffff",
          "opacity": 0.4,
          "width": 1
        },
        "move": {
          "enable": true,
          "speed": 5,
          "direction": "bottom",
          "random": false,
          "straight": false,
          "out_mode": "out",
          "bounce": false,
          "attract": {
            "enable": false,
            "rotateX": 600,
            "rotateY": 600
          }
        }
      },
      "interactivity": {
        "detect_on": "canvas",
        "events": {
          "onhover": {
            "enable": false,
            "mode": "bubble"
          },
          "onclick": {
            "enable": false,
            "mode": "repulse"
          },
          "resize": true
        },
        "modes": {
          "grab": {
            "distance": 400,
            "line_linked": {
              "opacity": 1
            }
          },
          "bubble": {
            "distance": 250,
            "size": 0,
            "duration": 2,
            "opacity": 0,
            "speed": 3
          },
          "repulse": {
            "distance": 400,
            "duration": 0.4
          },
          "push": {
            "particles_nb": 4
          },
          "remove": {
            "particles_nb": 2
          }
        }
      },
      "retina_detect": true
    }
    let turnoX = true;
    let winDetected = false;
    let draw = 1;
    const text = document.getElementById("text");
    const table = document.getElementById("table");
    const particlesInner = document.getElementById("particles-js");

    function setColor(color) {
      document.querySelector(":root").style.setProperty("--color", color)
      particles["particles"]["color"]["value"] = color;
    }

    document.querySelectorAll(".face").forEach(element => {
      function write() {
        turnoX ? (
          element.querySelector("#equis").style.opacity = "1"
        ) : (
          element.querySelector("#cero").style.opacity = "1"
        );
        verifyWin();
        if (draw < 9 && !winDetected) {
          turnoX ? (
            text.textContent = "turno de O",
            setColor("#0000ff")
          ) : (
            text.textContent = "turno de X",
            setColor("#ff0000")
          );
          draw++;
        } else if (draw == 9 && !winDetected) {
          table.classList.add("tableAnimation");
          text.classList.add("textAnimation");
          text.textContent = "Empate";
          setColor("black")
        }
        turnoX = !turnoX;
        element.removeEventListener("click", write);
      };
      element.addEventListener("click", write)
    });

    function verifyWin() {
      let winObj = turnoX ? "#equis" : "#cero";
      function Winner() {
        table.classList.add("tableAnimation");
        text.classList.add("textAnimation");
        text.textContent = `gana ${turnoX ? "X" : "O"}`;
        turnoX ? setColor("#ff0000") : setColor("#0000ff");
        winDetected = true;
      };

      let bar = document.querySelector(".bar");
      let barZone = document.querySelector(".barZone");
      function setBar(orientation, position) {
        let m1 = (100 / 6);
        let m3 = (100 / 6) * 5;
        function r(rotate) {
          return `translate(-50%,-50%) rotate(${rotate})`
        };
        bar.style.transform += orientation == "dl" ? r("45deg") : orientation == "dr" ? r("-45deg") : orientation == "v" ? r("90deg") : r("0deg");
        if (orientation == "h") {
          if (position == 1) {bar.style.top = m1+"%"};
          if (position == 3) {bar.style.top = m3+"%"};
        } else if (orientation == "v") {
          if (position == 1) {bar.style.left = m1+"%"};
          if (position == 3) {bar.style.left = m3+"%"};
        };
        barZone.classList.add("barZoneAnimation")
        bar.classList.add("barAnimation");
        particlesJS(particles)
        particlesInner.classList.add("particles-animation")
      };

      function detectCells(x, y, z, numberCombination) {
          if (
            getComputedStyle(document.getElementById(x).querySelector(winObj)).opacity === "1" &&
            getComputedStyle(document.getElementById(y).querySelector(winObj)).opacity === "1" &&
            getComputedStyle(document.getElementById(z).querySelector(winObj)).opacity === "1"
          ) {
            numberCombination = parseInt(numberCombination);
            if (numberCombination == 7) {setBar("dr")}
            else if (numberCombination == 6) {setBar("dl")}
            else if (numberCombination <= 5 && numberCombination > 2) {setBar("v", numberCombination - 2)}
            else if (numberCombination <= 2) {setBar("h", numberCombination + 1)}
            Winner();
          };
        };
      const winningCombinations = [[1, 2, 3], [4, 5, 6], [7, 8, 9],[1, 4, 7], [2, 5, 8], [3, 6, 9],  [1, 5, 9], [3, 5, 7]];
      for (let i in winningCombinations) {
        let combination = winningCombinations[i];
        detectCells(`face${combination[0]}`, `face${combination[1]}`, `face${combination[2]}`, i);
      };
    };
  </script>
</body>

</html>
